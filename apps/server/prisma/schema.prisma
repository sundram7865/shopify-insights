generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ========================
// 1. Tenant (User Account)
// ========================
model Tenant {
  id        String   @id @default(uuid())
  email     String   @unique
  password  String   
  storeName String?
  storeUrl  String?  @unique
  apiToken  String?
  
  createdAt DateTime @default(now())

  // Relations
  orders    Order[]
  customers Customer[]
  products  Product[]
   checkouts Checkout[]
}

// ========================
// 2. Customer
// ========================
model Customer {
  id                String   @id @default(uuid())
  shopifyCustomerId String
  email             String
  totalSpent        Decimal  @default(0.0)

  tenantId          String
  tenant            Tenant   @relation(fields: [tenantId], references: [id])

  orders            Order[]

  @@unique([shopifyCustomerId, tenantId])
}

// ========================
// 3. Product
// ========================
model Product {
  id                String   @id @default(uuid())
  shopifyProductId  String
  title             String
  price             Decimal

  tenantId          String
  tenant            Tenant   @relation(fields: [tenantId], references: [id])

  @@unique([shopifyProductId, tenantId])
}

// ========================
// 4. Order
// ========================
model Order {
  id             String   @id @default(uuid())
  shopifyOrderId String
  totalPrice     Decimal
  currency       String   @default("USD")

  tenantId       String
  tenant         Tenant   @relation(fields: [tenantId], references: [id])

  customerId     String?
  customer       Customer? @relation(fields: [customerId], references: [id])

  createdAt      DateTime @default(now())

  @@unique([shopifyOrderId, tenantId])
}

model Checkout {
  id                String   @id @default(uuid())
  shopifyCheckoutId String
  email             String?
  totalPrice        Decimal
  currency          String   @default("USD")
  abandonedCheckoutUrl String?
  isCompleted       Boolean  @default(false)

  tenantId          String
  tenant            Tenant   @relation(fields: [tenantId], references: [id])
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt // Tracks when they last touched the cart

  @@unique([shopifyCheckoutId, tenantId])
}