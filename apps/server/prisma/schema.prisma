generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  // Note: URL is handled by prisma.config.ts in Prisma 7
}

// 1. Tenant (The Store)
model Tenant {
  id          String     @id @default(uuid())
  storeName   String
  storeUrl    String     @unique
  apiToken    String   
  createdAt   DateTime   @default(now())
  
  // Relationships
  orders      Order[]
  customers   Customer[]
  products    Product[]
}

// 2. Customer
model Customer {
  id                String   @id @default(uuid())
  shopifyCustomerId String
  email             String
  totalSpent        Decimal  @default(0.0)
  
  // Multi-tenancy
  tenantId          String
  tenant            Tenant   @relation(fields: [tenantId], references: [id])
  
  orders            Order[]

  @@unique([shopifyCustomerId, tenantId])
}

// 3. Product (REQUIRED BY PDF)
model Product {
  id               String   @id @default(uuid())
  shopifyProductId String
  title            String
  price            Decimal
  
  // Multi-tenancy
  tenantId         String
  tenant           Tenant   @relation(fields: [tenantId], references: [id])

  @@unique([shopifyProductId, tenantId])
}

// 4. Order
model Order {
  id             String   @id @default(uuid())
  shopifyOrderId String
  totalPrice     Decimal
  currency       String   @default("USD")
  
  // Multi-tenancy
  tenantId       String
  tenant         Tenant   @relation(fields: [tenantId], references: [id])
  
  customerId     String?
  customer       Customer? @relation(fields: [customerId], references: [id])
  
  createdAt      DateTime @default(now())
  
  @@unique([shopifyOrderId, tenantId])
}